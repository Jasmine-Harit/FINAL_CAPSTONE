pipeline{
    agent any
    environment { 
        registry = "jasmine992/final-capstone" 
        registryCredential = 'jasmineh' 
        dockerImage = '' 
    }    
    tools { 
        maven 'maven3'
    }
    stages
       {
           stage("Install node modules")
           {
             steps
             {
               sh 'npm install'
             }
           }
       }
    stages
        {
           stage("Node Test")
           {
              steps
              {
                sh'npm test'
              }
            }
        }
        stage('Building our image') { 
                steps { 
                    script { 
                        dockerImage = docker.build registry + ":$GIT_COMMIT-$BUILD_NUMBER"
                    }
                } 
            }
         stage('Deploy our image') { 
                steps { 
                    script { 
                        docker.withRegistry( '', registryCredential ) { 
                            dockerImage.push() 
                        }
                    } 
                }
            }
          }
