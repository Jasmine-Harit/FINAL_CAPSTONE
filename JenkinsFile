pipeline
{
    agent any
    tools 
    {
        nodejs 'Node'
    }
    environment{
      dockerhub=credentials('dockerhub')    
      }

stages
  {

  stage('install node modules')
  {
    steps
    {
      sh 'npm install'
    }

  }
  

  stage('install node modules for client')
  {
      when{
          branch 'test'
      }
    steps
    {
       
      sh '''
      cd client
      npm install
      '''
    }
  }


stage(‘package’)
{
  when {
    branch 'prod'
  }
     stage('Building our image') { 
                steps { 
                    script { 
                        dockerImage = docker.build registry + ":$GIT_COMMIT-$BUILD_NUMBER"
                    }
                } 
            }
            stage('Deploy our image') { 
                steps { 
                    script { 
                        docker.withRegistry( '', registryCredential ) { 
                            dockerImage.push() 
                        }
                    } 
                }
            }
      }
}
        
